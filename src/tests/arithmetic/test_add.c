#include "../tests.h"

static s21_decimal num1[] = {
    /* 0*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
    /* 1*/ {{0x00000000, 0x00000000, 0x00000000, 0x80010000}},  // 0.0
                                                                /* 2*/
    {{0x00000001, 0x00000000, 0x00000000, 0x800E0000}},  // -0.00000000000001
    /* 3*/ {{0x00000019, 0x00000000, 0x00000000, 0x00010000}},  // 2.5
    /* 4*/ {{0x00000183, 0x00000000, 0x00000000, 0x00020000}},  // 3.87
                                                                /* 5*/
    {{0x14490831, 0x00048E23, 0x00000000, 0x00070000}},  // 128218122.2172721
    /* 6*/ {{0x00000001, 0x00000000, 0x00000000, 0x00000000}},  // 1
                                                                /* 7*/
    {{0x77D5E3AA, 0x0000011C, 0x00000000, 0x00060000}},  // 1221781.218218
                                                         /* 8*/
    {{0x80000000, 0x80000000, 0x80000000,
      0x801C0000}},  // -3.9614081266355540835774234624
                     /* 9*/
    {{0x80000000, 0x80000000, 0x80000000,
      0x000E0000}},  // 396140812663555.40835774234624
                     /*10*/
    {{0x00000001, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000001
                     /*11*/
    {{0x000F4240, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000001000000
                     /*12*/
    {{0x00000000, 0x00000000, 0x00000000, 0x000E0000}},  // 0.00000000000000
                                                         /*13*/
    {{0x00000000, 0x00000000, 0x00000000, 0x000E0000}},  // 0.00000000000000
                                                         /*14*/
    {{0x80000000, 0x80000000, 0x80000000,
      0x00000000}},  // 39614081266355540835774234624
                     /*15*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00010000}},  // 7922816251426433759354395033.5
                     /*16*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950335
                     /*17*/
    {{0x1422CF6C, 0x000001FC, 0x00000000, 0x80030000}},  // -2182181212.012
                                                         /*18*/
    {{0x2564B1EA, 0x3927F1F3, 0x041C50D7,
      0x000B0000}},  // 12721717217217217.21821901290
    /*19*/ {{0x0001869F, 0x00000000, 0x00000000, 0x00050000}},  // 0.99999
    /*20*/ {{0x0098967E, 0x00000000, 0x00000000, 0x80060000}},  // -9.999998
    /*21*/ {{0x000000CF, 0x00000000, 0x00000000, 0x00010000}},  // 20.7
                                                                /*22*/
    {{0x0707E3C5, 0x002D8D61, 0x00000000, 0x80090000}},  // -12821821.821281221
                                                         /*23*/
    {{0x846A4B4C, 0x0000012A, 0x00000000, 0x00080000}},  // 12821.21812812
                                                         /*24*/
    {{0x000035A3, 0x00000000, 0x00000000,
      0x00170000}},  // 0.00000000000000000013731
    // /*25*/ {{0x79353447, 0x00000004, 0x00000000, 0x00010000}},  //
    // 1921339911.1
    //                                                             /*26*/
    // {{0xFFFFFFFD, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x00000000}},  // 79228162514264337593543950333
    //                  /*27*/
    // {{0xFFFFFFFD, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x00000000}},  // 79228162514264337593543950333
    //                  /*28*/
    {{0xFFFFFFFD, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950333
    /*29*/
    {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950334
    /*30*/
    // {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x00000000}},  // 79228162514264337593543950334
    /*31*/
    {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950334
};

static s21_decimal num2[] = {
    /* 0*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
    /* 1*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
                                                                /* 2*/
    {{0x00000006, 0x00000000, 0x00000000, 0x000F0000}},  // 0.000000000000006
    /* 3*/ {{0x00000064, 0x00000000, 0x00000000, 0x00000000}},  // 100
    /* 4*/ {{0x00004DA6, 0x00000000, 0x00000000, 0x00020000}},  // 198.78
    /* 5*/ {{0x164214B7, 0x00000028, 0x00000000, 0x00040000}},  // 17217212.1271
    /* 6*/ {{0x00000019, 0x00000000, 0x00000000, 0x00010000}},  // 2.5
    /* 7*/ {{0x00212155, 0x00000000, 0x00000000, 0x00070000}},  // 0.2171221
                                                                /* 8*/
    {{0x80000000, 0x80000000, 0x80000000,
      0x801C0000}},  // -3.9614081266355540835774234624
                     /* 9*/
    {{0x80000000, 0x80000000, 0x80000000,
      0x000E0000}},  // 396140812663555.40835774234624
                     /*10*/
    {{0x00000001, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000001
                     /*11*/
    {{0x000186A0, 0x00000000, 0x00000000,
      0x00140000}},  // 0.00000000000000100000
    /*12*/ {{0x00000000, 0x00000000, 0x00000000, 0x000A0000}},  // 0.0000000000
                                                                /*13*/
    {{0x00000000, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000000
                     /*14*/
    {{0x00000000, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000000
    /*15*/ {{0x00000005, 0x00000000, 0x00000000, 0x00010000}},  // 0.5
    /*16*/ {{0x00000000, 0x00000000, 0x00000000, 0x000A0000}},  // 0.0000000000
                                                                /*17*/
    {{0xF96C01C5, 0x0007B6B6, 0x00000000, 0x800B0000}},  // -21712.21821882821
                                                         /*18*/
    {{0x00033F4A, 0x00000000, 0x00000000, 0x000C0000}},  // 0.000000212810
    /*19*/ {{0x00000001, 0x00000000, 0x00000000, 0x00050000}},  // 0.00001
    /*20*/ {{0x00000002, 0x00000000, 0x00000000, 0x80060000}},  // -0.000002
                                                                /*21*/
    {{0x00003F86, 0x00000000, 0x00000000,
      0x00160000}},  // 0.0000000000000000016262
    /*22*/ {{0x058FEC8A, 0x00000000, 0x00000000, 0x00050000}},  // 933.18282
    /*23*/ {{0x0081787B, 0x00000000, 0x00000000, 0x80080000}},  // -0.08484987
    /*24*/ {{0x0001F8A8, 0x00000000, 0x00000000, 0x00030000}},  // 129.192
                                                                /*25*/
    // {{0xD927FFFF, 0xE1003B28, 0x00000004,
    //   0x00140000}},  // 0.89999999999999999999
    // /*26*/ {{0x00000005, 0x00000000, 0x00000000, 0x00010000}},  // 0.5
    // /*27*/ {{0x00000033, 0x00000000, 0x00000000, 0x00020000}},  // 0.51
    /*28*/ {{0x00000031, 0x00000000, 0x00000000, 0x00020000}},  // 0.49
    /*29*/ {{0x00000005, 0x00000000, 0x00000000, 0x00010000}},  // 0.5
    // /*30*/ {{0x00000033, 0x00000000, 0x00000000, 0x00020000}},  // 0.51
    /*31*/ {{0x00000031, 0x00000000, 0x00000000, 0x00020000}},  // 0.49
};

static s21_decimal result[] = {
    /* 0*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
    /* 1*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
                                                                /* 2*/
    {{0x00000004, 0x00000000, 0x00000000, 0x800F0000}},  //-0.000000000000004
    /* 3*/ {{0x00000401, 0x00000000, 0x00000000, 0x00010000}},  // 102.5
    /* 4*/ {{0x00004F29, 0x00000000, 0x00000000, 0x00020000}},  // 202.65
                                                                /* 5*/
    {{0x0669F309, 0x00052ABA, 0x00000000, 0x00070000}},  // 145435334.3443721
    /* 6*/ {{0x00000023, 0x00000000, 0x00000000, 0x00010000}},  // 3.5
                                                                /* 7*/
    {{0xAE7C05F9, 0x00000B1C, 0x00000000, 0x00070000}},  // 1221781.4353401
                                                         /* 8*/
    {{0x4CCCCCCD, 0xB3333333, 0x19999999,
      0x801B0000}},  //-7.922816253271108167154846925
                     /* 9*/
    {{0x4CCCCCCD, 0xB3333333, 0x19999999,
      0x000D0000}},  // 792281625327110.8167154846925
                     /*10*/
    {{0x00000002, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000002
                     /*11*/
    {{0x00989681, 0x00000000, 0x00000000,
      0x00160000}},  // 0.0000000000000010000001
    /*12*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
    /*13*/ {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
                                                                /*14*/
    {{0x80000000, 0x80000000, 0x80000000,
      0x00000000}},  // 39614081266355540835774234624
                     /*15*/
    {{0x9999999A, 0x99999999, 0x19999999,
      0x00000000}},  // 7922816251426433759354395034
                     /*16*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950335
                     /*17*/
    {{0x3015EDC5, 0xD46A37C7, 0x0000000B,
      0x800B0000}},  //-2182202924.23021882821
                     /*18*/
    {{0x2565050B, 0x3927F1F3, 0x041C50D7,
      0x000B0000}},  // 12721717217217217.21821922571
    /*19*/ {{0x00000001, 0x00000000, 0x00000000, 0x00000000}},  // 1
    /*20*/ {{0x0000000A, 0x00000000, 0x00000000, 0x80000000}},  //-10
                                                                /*21*/
    {{0x03603F86, 0x7E1382FF, 0x00002BD5,
      0x00160000}},  // 20.7000000000000000016262
                     /*22*/
    {{0xC1001525, 0x002D8C87, 0x00000000, 0x80090000}},  //-12820888.638461221
                                                         /*23*/
    {{0x83E8D2D1, 0x0000012A, 0x00000000, 0x00080000}},  // 12821.13327825
                                                         /*24*/
    {{0x828035A3, 0x3C3F28D0, 0x000AAFBF,
      0x00170000}},  // 129.19200000000000000013731
    // /*25*/ {{0x72855208, 0x00000000, 0x00000000, 0x00000000}},  // 1921339912
    //                                                             /*26*/
    // {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x00000000}},  // 79228162514264337593543950334
    //                  /*27*/
    // {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x00000000}},  // 79228162514264337593543950334
    //                  /*28*/
    {{0xFFFFFFFD, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950333
    /*29*/
    {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950334
                     /*30*/
    // {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x00000000}},  // 79228162514264337593543950335
    /*31*/
    {{0xFFFFFFFE, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950334
};

static s21_decimal err_num1[] = {
    // /* 0*/ {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
    //          0x00000000}},  // 79228162514264337593543950335
    /* 1*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543950335
    /* 2*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00010000}},  // 7922816251426433759354395033.5
                     /* 3*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00020000}},  // 792281625142643375935439503.35
                     /* 4*/
    // {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
    //   0x80000000}},  // -79228162514264337593543950335
    /* 5*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x80000000}},  // -79228162514264337593543950335
    /* 6*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x80040000}},  // -7922816251426433759354395.0335
                     /* 7*/
    {{0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x80080000}},  // -792281625142643375935.43950335
};

static s21_decimal err_num2[] = {
    // /* 0*/ {{0x00000006, 0x00000000, 0x00000000, 0x00010000}},  // 0.6
    /* 1*/ {{0x00000001, 0x00000000, 0x00000000, 0x00000000}},  // 1
    /* 2*/
    {{0xFFF0BDBF, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593542950335
                     /* 3*/
    {{0xFFFE7906, 0xFFFFFFFF, 0xFFFFFFFF,
      0x00000000}},  // 79228162514264337593543850246
    // /* 4*/ {{0x00000007, 0x00000000, 0x00000000, 0x80010000}},  //-0.7
    /* 5*/ {{0x0000000A, 0x00000000, 0x00000000, 0x80010000}},  //-1.0
    /* 6*/
    {{0xFF67697F, 0xFFFFFFFF, 0xFFFFFFFF,
      0x80000000}},  //-79228162514264337593533950335
                     /* 7*/
    {{0xFF642CF2, 0xFFFFFFFF, 0xFFFFFFFF,
      0x80000000}},  //-79228162514264337593533738226
};

static int err_result[] = {
    // /* 0*/ 1,
    /* 1*/ 1,
    /* 2*/ 1,
    /* 3*/ 1,
    // /* 4*/ 2,
    /* 5*/ 2,
    /* 6*/ 2,
    /* 7*/ 2,
};

START_TEST(test) {
  for (size_t i = 0; i < sizeof(num1) / sizeof(s21_decimal); ++i) {
    s21_decimal tmp;
    int ret = s21_add(num1[i], num2[i], &tmp);
    ck_assert_int_eq(tmp.bits[0], result[i].bits[0]);
    ck_assert_int_eq(tmp.bits[1], result[i].bits[1]);
    ck_assert_int_eq(tmp.bits[2], result[i].bits[2]);
    ck_assert_int_eq(tmp.bits[3], result[i].bits[3]);
    ck_assert_int_eq(ret, 0);
  }
}
END_TEST

START_TEST(error_test) {
  for (size_t i = 0; i < sizeof(err_num1) / sizeof(s21_decimal); ++i) {
    s21_decimal tmp;
    int ret = s21_add(err_num1[i], err_num2[i], &tmp);
    if (tmp.bits[0] == 0) {
      tmp.bits[0] = 1;
    }
    ck_assert_int_eq(ret, err_result[i]);
  }
}
END_TEST

Suite *test_add(void) {
  Suite *s = suite_create("\033[41m==S21_ADD==\033[0m");
  TCase *tc = tcase_create("add_tc");

  if (s != NULL && tc != NULL) {
    tcase_add_test(tc, test);
    tcase_add_test(tc, error_test);
    suite_add_tcase(s, tc);
  }

  return (s);
}
